<div class="custom-container">
<h3 class="toc-title">Table of Contents</h3>
<ol class="toc-list">
<li><a href="#cf-overview">AWS CloudFormation Overview</a></li>
<li><a href="#cf-benefits">Key Benefits</a></li>
<li><a href="#cf-concepts">Key Concepts</a></li>
<li><a href="#cf-templates">Templates</a>
<ol>
<li><a href="#template-elements">Template Elements</a></li>
<li><a href="#resources">Resources (Mandatory)</a></li>
<li><a href="#parameters">Parameters</a></li>
<li><a href="#pseudo-parameters">Pseudo Parameters</a></li>
<li><a href="#mappings">Mappings</a></li>
<li><a href="#outputs">Outputs</a></li>
<li><a href="#conditions">Conditions</a></li>
<li><a href="#transform">Transform</a></li>
</ol>
</li>
<li><a href="#intrinsic-functions">Intrinsic Functions (Crucial for Exam!)</a></li>
<li><a href="#stacks-stacksets">Stacks and Stack Sets</a>
<ol>
<li><a href="#stacks">Stacks</a></li>
<li><a href="#stack-sets">Stack Sets</a></li>
<li><a href="#nested-stacks">Nested Stacks</a></li>
</ol>
</li>
<li><a href="#cf-helper-scripts">CloudFormation Helper Scripts</a>
<ol>
<li><a href="#cfn-init">cfn-init</a></li>
<li><a href="#cfn-signal">cfn-signal</a></li>
</ol>
</li>
<li><a href="#cf-attributes">CloudFormation Resource Attributes</a>
<ol>
<li><a href="#creation-policy">CreationPolicy</a></li>
<li><a href="#deletion-policy">DeletionPolicy</a></li>
<li><a href="#depends-on">DependsOn</a></li>
<li><a href="#wait-condition">WaitCondition</a></li>
<li><a href="#update-policy">UpdatePolicy</a></li>
<li><a href="#update-replace-policy">UpdateReplacePolicy</a></li>
</ol>
</li>
<li><a href="#cf-troubleshooting">Troubleshooting Errors</a></li>
<li><a href="#cf-monitoring">Monitoring and Reporting</a></li>
<li><a href="#cf-access-control">Authorization and Access Control</a></li>
<li><a href="#cf-charges">Charges</a></li>
<li><a href="#cf-best-practices">Best Practices</a></li>
<li><a href="#cf-sam">Serverless Application Model (SAM)</a></li>
<li><a href="#cf-exam-tips">Important Exam Tips & Tricks</a></li>
</ol>
</div>
<hr>

<h3 id="cf-overview">AWS CloudFormation Overview</h3>
<ul>
<li><strong>Definition:</strong> Service to manage, configure, and provision AWS infrastructure as code.</li>
<li>Provides a common language (YAML or JSON) to describe and provision cloud resources.</li>
<li>Interprets templates and makes appropriate API calls to create defined resources.</li>
<li>Can provision a broad range of AWS resources.</li>
<li>Think of it as Infrastructure as Code (IaC).</li>
</ul>
<div class="table-responsive-wrapper">
<table class="styled-table">
<thead>
<tr>
<th>CloudFormation</th>
<th>Elastic Beanstalk</th>
</tr>
</thead>
<tbody>
<tr>
<td>"Template-driven provisioning"</td>
<td>"Web apps made easy"</td>
</tr>
<tr>
<td>Deploys infrastructure using code</td>
<td>Deploys applications on EC2 (PaaS)</td>
</tr>
<tr>
<td>Can be used to deploy almost any AWS service</td>
<td>Deploys web applications based on Java, .NET, PHP, Node.js, Python, Ruby, Go, and Docker</td>
</tr>
<tr>
<td>Uses JSON or YAML template files</td>
<td>Uses ZIP or WAR files</td>
</tr>
<tr>
<td>Similar to Terraform</td>
<td>Similar to Google App Engine</td>
</tr>
</tbody>
</table>
</div>
<hr>

<h3 id="cf-benefits">Key Benefits</h3>
<ul>
<li>Infrastructure is provisioned consistently, with fewer human errors.</li>
<li>Less time and effort than manual configuration.</li>
<li>Supports version control and peer review for templates.</li>
<li>Free to use (only charged for resources provisioned).</li>
<li>Manages updates and dependencies.</li>
<li>Can rollback and delete the entire stack.</li>
</ul>
<hr>

<h3 id="cf-concepts">Key Concepts</h3>
<div class="table-responsive-wrapper">
<table class="styled-table">
<thead>
<tr>
<th>Component</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Templates</strong></td>
<td>JSON or YAML text file containing instructions for building out the AWS environment.</td>
</tr>
<tr>
<td><strong>Stacks</strong></td>
<td>The entire environment described by the template; created, updated, and deleted as a single unit.</td>
</tr>
<tr>
<td><strong>StackSets</strong></td>
<td>Extends stacks to create, update, or delete stacks across multiple accounts and regions with a single operation.</td>
</tr>
<tr>
<td><strong>Change Sets</strong></td>
<td>A summary of proposed changes to your stack; allows previewing impact before implementation.</td>
</tr>
</tbody>
</table>
</div>
<hr>

<h3 id="cf-templates">Templates</h3>
<ul>
<li>YAML or JSON file describing the end-state of infrastructure.</li>
<li>Uploaded directly to CloudFormation or via S3.</li>
<li>CloudFormation reads the template and makes API calls.</li>
<li>Resulting resources are called a "Stack".</li>
<li><strong>Logical IDs:</strong> Used to reference resources within the template.</li>
<li><strong>Physical IDs:</strong> Identify resources outside CloudFormation templates, after creation.</li>
</ul>

<h4 id="template-elements">Template Elements (Sections)</h4>
<ul>
<li><strong>Mandatory:</strong> <code>Resources</code> section.</li>
<li><strong>Not Mandatory:</strong> Parameters (limit 60), Output values (limit 60), Mappings, Conditions, Transform.</li>
</ul>

<h4 id="resources">Resources (Mandatory)</h4>
<ul>
<li>Declares AWS resources to be included in the stack (e.g., EC2 instance, S3 bucket).</li>
<li>Represent AWS components that will be created.</li>
<li>Declared resources can reference each other.</li>
<li>Example:
<pre><code>Resources:
MyEC2Instance:
Type: "AWS::EC2::Instance"
Properties:
ImageId: "ami-0ff8a91507f77f867"</code></pre>
</li>
</ul>

<h4 id="parameters">Parameters</h4>
<ul>
<li>Used to customize templates; input custom values each time a stack is created/updated.</li>
<li>Useful for template reuse.</li>
<li>Example (with default and allowed values):
<pre><code>Parameters:
InstanceTypeParameter:
Type: String
Default: t2.micro
AllowedValues:
- t2.micro
- m1.small
- m1.large
Description: Enter t2.micro, m1.small, or m1.large. Default is t2.micro.</code></pre>
</li>
</ul>

<h4 id="pseudo-parameters">Pseudo Parameters</h4>
<ul>
<li>Predefined by AWS CloudFormation; not declared in your template.</li>
<li>Used with the <code>!Ref</code> function.</li>
<li>Examples: <code>AWS::AccountId</code>, <code>AWS::NotificationARNs</code>, <code>AWS::Region</code>, <code>AWS::StackId</code>, <code>AWS::StackName</code>, <code>AWS::URLSuffix</code>, <code>AWS::Partition</code>.</li>
</ul>

<h4 id="mappings">Mappings</h4>
<ul>
<li>Matches a key to a corresponding set of named values (two-level map).</li>
<li>Fixed variables, good for differentiating values based on region, environment, AMIs, etc.</li>
<li>Values must be known in advance. Use parameters for user-specific values.</li>
<li>Example:
<pre><code>RegionMap:
us-east-1:
HVM64: ami-0ff8a91507f77f867
HVMG2: ami-0a584ac55a7631c0c
us-west-1:
HVM64: ami-0bdb828fd58c52235
HVMG2: ami-066ee5fd4a9ef77f1</code></pre>
</li>
</ul>

<h4 id="outputs">Outputs</h4>
<ul>
<li>Declares output values that can be:
<ul>
<li>Imported into other stacks (for cross-stack references).</li>
<li>Returned in response to describe stack calls.</li>
<li>Viewed on the AWS CloudFormation console.</li>
</ul>
</li>
<li>Cannot delete a stack if its outputs are being referenced by another CloudFormation stack.</li>
<li>Example (with Export for cross-stack referencing):
<pre><code>Outputs:
StackVPC:
Description: The ID of the VPC
Value: !Ref MyVPC
Export:
Name: !Sub "${AWS::StackName}-VPCID"</code></pre>
</li>
</ul>

<h4 id="conditions">Conditions</h4>
<ul>
<li>Define circumstances under which entities (resources, outputs) are created or configured.</li>
<li>Control the creation of resources based on a condition.</li>
<li>Example:
<pre><code>Conditions:
CreateProdResources: !Equals [ !Ref EnvType, prod ]</code></pre>
</li>
</ul>

<h4 id="transform">Transform</h4>
<ul>
<li>Specifies one or more macros that CloudFormation uses to process your template.</li>
<li>Can reference additional code stored in S3 (Lambda code, reusable snippets).</li>
<li>The AWS::Serverless-2016-10-31 transform (AWS SAM macro) expands SAM syntax into CloudFormation.</li>
<li>Example:
<pre><code>Transform: AWS::Serverless-2016-10-31
Resources:
MyServerlessFunctionLogicalID:
Type: AWS::Serverless::Function
Properties:
Handler: index.handler
Runtime: nodejs8.10
CodeUri: 's3://testBucket/mySourceCode.zip'</code></pre>
</li>
</ul>
<hr>

<h3 id="intrinsic-functions">Intrinsic Functions (Crucial for Exam!)</h3>
<ul>
<li>Built-in functions to assign values to properties not available until runtime.</li>
<li>YAML Short Forms: Use !Fn::FunctionName or !FunctionName (e.g., !Ref, !GetAtt).</li>
<li><strong><code>!Ref</code> (or <code>Fn::Ref</code>):</strong>
<ul>
<li>Returns the value of the specified parameter or resource.</li>
<li>For parameters: returns the parameter's value.</li>
<li>For resources: returns a value that typically refers to that resource (e.g., physical ID).</li>
<li>Example: InstanceId: !Ref MyEC2Instance</li>
</ul>
</li>
<li><strong><code>!GetAtt</code> (or <code>Fn::GetAtt</code>):</strong>
<ul>
<li>Returns the value of an attribute from a resource.</li>
<li>Syntax: !GetAtt LogicalNameOfResource.AttributeName</li>
<li>Example: SourceSecurityGroupOwnerId: !GetAtt myELB.SourceSecurityGroup.OwnerAlias</li>
</ul>
</li>
<li><strong><code>!FindInMap</code> (or <code>Fn::FindInMap</code>):</strong>
<ul>
<li>Returns a value from a two-level map declared in the Mappings section.</li>
<li>Syntax: !FindInMap [ MapName, TopLevelKey, SecondLevelKey ]</li>
<li>Example: ImageId: !FindInMap [ RegionMap, !Ref &#39;AWS::Region&#39;, HVM64 ]</li>
</ul>
</li>
<li><strong><code>!ImportValue</code> (or <code>Fn::ImportValue</code>):</strong>
<ul>
<li>Returns the value of an output exported by another stack (cross-stack references).</li>
<li>Example: !ImportValue !Sub &quot;${NetworkStackName}-SecurityGroupID&quot;</li>
</ul>
</li>
<li><strong><code>!Join</code> (or <code>Fn::Join</code>):</strong>
<ul>
<li>Concatenates a list of values into a single string, separated by a delimiter.</li>
<li>Syntax: !Join [ delimiter, [ comma-delimited list of values ] ]</li>
<li>Example: !Join [&#39;&#39;, [&#39;arn:&#39;, !Ref Partition, &#39;:s3:::elasticbeanstalk-*-&#39;, !Ref &#39;AWS::AccountId&#39;]]</li>
</ul>
</li>
<li><strong><code>!Sub</code> (or <code>Fn::Sub</code>):</strong>
<ul>
<li>Substitutes variables in an input string with specified values.</li>
<li>Can use $ or ${variable} syntax.</li>
<li>Example: Name: !Sub &#39;www.${Domain}&#39; (where Domain is a parameter or other reference).</li>
</ul>
</li>
</ul>
<hr>

<h3 id="stacks-stacksets">Stacks and Stack Sets</h3>
<h4 id="stacks">Stacks</h4>
<ul>
<li>Deployed resources based on templates.</li>
<li>Managed via Console, CLI, or APIs.</li>
<li><strong>Stack Creation Errors:</strong>
<ul>
<li>Automatic rollback on error is enabled by default.</li>
<li>You are charged for resources provisioned even if there is an error (before rollback).</li>
<li>Can optionally disable rollback for troubleshooting.</li>
</ul>
</li>
<li><strong>Updating Stacks:</strong>
<ul>
<li><strong>Direct Update:</strong> Submit changes, CloudFormation immediately deploys. Use for quick deployments.</li>
<li><strong>Change Sets:</strong> Preview proposed changes before applying them. Recommended for critical updates to understand impact.</li>
</ul>
</li>
<li><strong>Stack Update Failures:</strong> Stack automatically rolls back to the previous known working state.</li>
</ul>

<h4 id="stack-sets">Stack Sets</h4>
<ul>
<li>Create, update, or delete stacks across multiple accounts and regions with a single operation.</li>
<li>Requires an administrator account (where stack set is created) and target accounts (where stacks are deployed).</li>
<li>Trust relationship must be set up between admin and target accounts.</li>
</ul>

<h4 id="nested-stacks">Nested Stacks</h4>
<ul>
<li>Allow re-use of CloudFormation code for common use cases (e.g., standard LB, web server configs).</li>
<li>Create standard templates for common uses and reference them from within your main template.</li>
</ul>
<hr>

<h3 id="cf-helper-scripts">CloudFormation Helper Scripts</h3>
<ul>
<li>Python scripts that assist with instance configuration.</li>
<li>Logs for these scripts are typically found in /var/log/cloud-init-output.log (general CloudInit) and /var/log/cfn-init.log (specifically for cfn-init).</li>
<li>Binary available on EC2 at /opt/aws/bin/cfn-init.</li>
</ul>
<h4 id="cfn-init">cfn-init</h4>
<ul>
<li>Reads template metadata from the AWS::CloudFormation::Init key.</li>
<li>Actions: Fetch/parse metadata, install packages, write files, enable/disable/start/stop services.</li>
<li>Does not require credentials (no access key, secret key, role, or credential file options).</li>
</ul>
<h4 id="cfn-signal">cfn-signal</h4>
<ul>
<li>Signals CloudFormation to indicate whether EC2 instances (or other resources) have been successfully created or updated.</li>
<li>Used in conjunction with a CreationPolicy or an Auto Scaling group with a WaitOnResourceSignals update policy.</li>
<li>CloudFormation suspends work until it receives the required signals or timeout.</li>
<li>Can signal a CreationPolicy or a WaitCondition handle.</li>
</ul>
<hr>

<h3 id="cf-attributes">CloudFormation Resource Attributes</h3>
<ul>
<li>These attributes control resource behavior during stack operations.</li>
</ul>
<h4 id="creation-policy">CreationPolicy attribute</h4>
<ul>
<li>Used to wait on resource configuration actions before stack creation proceeds.</li>
<li>Prevents resource status from reaching create complete until a specified number of success signals are received or timeout.</li>
<li>Signal using cfn-signal helper script or SignalResource API.</li>
<li>Supported by AWS::AutoScaling::AutoScalingGroup, AWS::EC2::Instance, AWS::CloudFormation::WaitCondition.</li>
</ul>
<h4 id="deletion-policy">DeletionPolicy attribute</h4>
<ul>
<li>Preserves or backs up a resource when its stack is deleted.</li>
<li>If not specified, CloudFormation deletes the resource by default.</li>
<li>Common values: Retain, Snapshot, Delete (default).</li>
</ul>
<h4 id="depends-on">DependsOn attribute</h4>
<ul>
<li>Specifies that the creation of a resource must follow another.</li>
<li>Resource is created only after the resource specified in DependsOn is created.</li>
<li>Useful for explicit ordering when implicit dependencies aren't enough.</li>
</ul>
<h4 id="wait-condition">WaitCondition</h4>
<ul>
<li>Used to coordinate stack resource creation with external configuration actions or track status of a process.</li>
<li>Note: For EC2 and Auto Scaling resources, AWS recommends CreationPolicy instead of WaitCondition.</li>
</ul>
<h4 id="update-policy">UpdatePolicy attribute (WaitOnResourceSignals)</h4>
<ul>
<li>Specifies how CloudFormation handles updates to resources like AWS::AutoScaling::AutoScalingGroup, AWS::ElastiCache::ReplicationGroup, AWS::Elasticsearch::Domain, AWS::Lambda::Alias.</li>
</ul>
<h4 id="update-replace-policy">UpdateReplacePolicy attribute</h4>
<ul>
<li>Retains or backs up the existing physical instance of a resource when it's replaced during a stack update.</li>
</ul>
<hr>

<h3 id="cf-troubleshooting">Troubleshooting Errors</h3>
<ul>
<li>Verify AMI includes CloudFormation helper scripts.</li>
<li>Check cfn-init and cfn-signal logs (/var/log/cfn-init.log, /var/log/cloud-init-output.log).</li>
<li>Verify internet connectivity from the instance.</li>
</ul>
<hr>

<h3 id="cf-monitoring">Monitoring and Reporting</h3>
<ul>
<li>Monitor stack progress by viewing stack's events in the console (Events tab).</li>
<li>For resources created by CloudFormation, use standard AWS monitoring/reporting tools (CloudWatch, CloudTrail) applicable to that service.</li>
</ul>
<hr>

<h3 id="cf-access-control">Authorization and Access Control</h3>
<ul>
<li>Use IAM to control user actions with CloudFormation (e.g., view templates, create/delete stacks).</li>
<li>IAM also controls which AWS services and resources are available to users when they use CloudFormation.</li>
</ul>
<hr>

<h3 id="cf-charges">Charges</h3>
<ul>
<li>No additional charge for AWS CloudFormation itself.</li>
<li>You pay for the AWS resources created using CloudFormation in the same manner as if created manually.</li>
<li>Pay-as-you-go, no minimum fees or upfront commitments.</li>
</ul>
<hr>

<h3 id="cf-best-practices">Best Practices</h3>
<ul>
<li>Use CloudFormation for all infrastructure changes (avoid manual changes).</li>
<li>Make use of Change Sets to identify potential issues before updates.</li>
<li>Use Stack Policies to explicitly protect sensitive portions of your stack from accidental updates/deletions.</li>
<li>Use a version control system (CodeCommit, GitHub) to track template changes.</li>
<li>Use Python "helper scripts" (cfn-init, cfn-signal) for software installation/configuration on EC2.</li>
</ul>
<hr>

<h3 id="cf-sam">Serverless Application Model (SAM)</h3>
<ul>
<li>Extension to CloudFormation specifically for defining serverless applications.</li>
<li>Provides simplified syntax for serverless resources (APIs, Lambda Functions, DynamoDB Tables).</li>
<li>Use the SAM CLI to package, upload to S3, and deploy your serverless application.</li>
<li>The Transform: AWS::Serverless-2016-10-31 header indicates a SAM template.</li>
</ul>
<hr>

<h3 id="cf-exam-tips">Important Exam Tips & Tricks</h3>
<ul>
<li><strong>IaC Core:</strong> CloudFormation is AWS's primary Infrastructure as Code tool.</li>
<li><strong>Template Language:</strong> YAML and JSON are both supported.</li>
<li><strong>Logical vs. Physical IDs:</strong> Understand the difference and when each is used (!Ref often returns physical ID for resources).</li>
<li><strong>Intrinsic Functions:</strong> Master !Ref, !GetAtt, !FindInMap, !Sub, !Join, !ImportValue. These are heavily tested. Know their syntax and use cases.</li>
<li><strong>Stack Rollback:</strong>
<ul>
<li>Creation Failure: Rollback is default enabled. You are still charged for resources provisioned before the rollback.</li>
<li>Update Failure: Rollback is automatic to the last known good state.</li>
</ul>
</li>
<li><strong>Change Sets:</strong> Used to preview changes before applying. Crucial for understanding impact.</li>
<li><strong>StackSets:</strong> For multi-account, multi-region deployments.</li>
<li><strong>Nested Stacks:</strong> For reusability and modularity of templates.</li>
<li><strong>Helper Scripts (cfn-init, cfn-signal):</strong>
<ul>
<li>cfn-init: For installing/configuring software on EC2 instances from template metadata.</li>
<li>cfn-signal: For signaling CloudFormation about instance readiness (used with CreationPolicy or WaitCondition).</li>
<li>Remember their log file locations.</li>
</ul>
</li>
<li><strong>Resource Attributes (CreationPolicy, DeletionPolicy, DependsOn):</strong> Know their purpose and how they influence stack behavior. DeletionPolicy: Retain is key for preventing accidental data loss.</li>
<li><strong>CloudFormation vs. Elastic Beanstalk:</strong> CloudFormation is for infrastructure, Elastic Beanstalk is for applications (PaaS). They are complementary.</li>
<li><strong>SAM:</strong> It's a transform that extends CloudFormation for serverless deployments. Know the Transform header.</li>
<li><strong>Security:</strong> IAM permissions control who can create/manage stacks and what resources CloudFormation can create.</li>
<li><strong>Cost:</strong> CloudFormation itself is free; you pay for the resources it creates.</li>
</ul>
<hr>