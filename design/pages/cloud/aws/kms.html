<div class="custom-container">
<h3 class="toc-title">Table of Contents</h3>
<ol class="toc-list">
<li><a href="#kms-overview">AWS Key Management Service (KMS) Overview</a></li>
<li><a href="#kms-keys">AWS KMS Keys (CMKs)</a>
<ol>
<li><a href="#customer-managed-kms">Customer Managed KMS Keys</a></li>
<li><a href="#aws-managed-kms">AWS Managed KMS Keys</a></li>
<li><a href="#aws-owned-kms">AWS Owned KMS Keys</a></li>
</ol>
</li>
<li><a href="#data-encryption-keys">Data Encryption Keys (DEKs)</a></li>
<li><a href="#kms-details">KMS Core Details</a></li>
<li><a href="#key-management">Key Management with KMS Functions</a></li>
<li><a href="#data-encryption-scenarios">Data Encryption Scenarios</a></li>
<li><a href="#custom-key-store">Custom Key Store</a></li>
<li><a href="#key-deletion">Key Deletion</a></li>
<li><a href="#kms-apis">AWS KMS APIs (Developer Focus)</a></li>
<li><a href="#envelope-encryption">KMS Envelope Encryption</a></li>
<li><a href="#kms-limits">KMS Limits</a></li>
<li><a href="#kms-exam-tips">Important Exam Tips</a></li>
</ol>
</div>
<hr>

<h3 id="kms-overview">AWS Key Management Service (KMS) Overview</h3>
<ul>
<li><strong>Definition:</strong> A managed service for easily creating and controlling encryption keys used to encrypt your data.</li>
<li><strong>Purpose:</strong> Provides highly available key storage, management, and auditing.</li>
<li>Used to encrypt data within your own applications and control encryption of data across AWS services.</li>
<li>Allows centrally managing and securely storing your keys, known as AWS KMS keys (formerly Customer Master Keys - CMKs).</li>
</ul>
<hr>

<h3 id="kms-keys">AWS KMS Keys (CMKs)</h3>
<ul>
<li>Primary resources in AWS KMS.</li>
<li>Include metadata (ID, creation date, description, key state) and the key material.</li>
<li>Supports symmetric and asymmetric KMS keys.</li>
<li>Symmetric KMS keys and private keys of asymmetric KMS keys never leave KMS unencrypted.</li>
<li>By default, AWS KMS creates the key material.</li>
<li>A KMS key can encrypt data up to 4KB in size.</li>
<li>Can generate, encrypt, and decrypt Data Encryption Keys (DEKs).</li>
<li>A KMS key can never be exported from KMS (CloudHSM allows this).</li>
</ul>

<h4 id="customer-managed-kms">Customer Managed KMS Keys</h4>
<ul>
<li>KMS keys in your AWS account that you create, own, and manage.</li>
<li>Full control: Establish/maintain key policies, IAM policies, grants; enable/disable, rotate cryptographic material, add tags, create aliases, schedule for deletion.</li>
<li><strong>Cost:</strong> Incur a monthly fee and a fee for usage beyond the free tier.</li>
</ul>

<h4 id="aws-managed-kms">AWS Managed KMS Keys</h4>
<ul>
<li>KMS keys in your account created, managed, and used on your behalf by an AWS service (e.g., S3, EBS, RDS).</li>
<li>You cannot manage, rotate, or change their key policies.</li>
<li>Cannot use directly in cryptographic operations; the service uses them on your behalf.</li>
<li><strong>Cost:</strong> No monthly fee; may have usage fees (some AWS services cover these).</li>
<li>Created on the first time you implement encryption using that service.</li>
<li>Can only be used by the service that created them within a particular region.</li>
</ul>

<h4 id="aws-owned-kms">AWS Owned KMS Keys</h4>
<ul>
<li>Collection of KMS keys that an AWS service owns and manages for use in multiple AWS accounts.</li>
<li>Not in your AWS account. AWS service uses them to protect your resources.</li>
<li>You do not create, manage, view, use, track, or audit them.</li>
<li><strong>Cost:</strong> No monthly fee or usage fee; do not count against KMS quotas.</li>
</ul>
<hr>

<h3 id="data-encryption-keys">Data Encryption Keys (DEKs)</h3>
<ul>
<li>Encryption keys used to encrypt data, including large amounts of data.</li>
<li>AWS KMS keys are used to generate, encrypt, and decrypt DEKs.</li>
<li>AWS KMS does not store, manage, or track your DEKs.</li>
<li>You must use and manage DEKs outside of AWS KMS.</li>
<li>The <code>GenerateDataKey</code> API is used to create a DEK using a KMS key.</li>
</ul>
<hr>

<h3 id="kms-details">KMS Core Details</h3>
<ul>
<li>Set usage policies on keys (determine users, conditions for encryption/decryption).</li>
<li><strong>Key Material Options:</strong> KMS generated, or import your own.</li>
<li>Master keys are protected by Hardware Security Modules (HSMs) and used only within them.</li>
<li>KMS is for encryption at rest only (use SSL/TLS for in-transit encryption).</li>
<li>Tightly integrated into many AWS services (Lambda, S3, EBS, EFS, DynamoDB, SQS, etc.).</li>
<li>AWS services encrypt your data and store an encrypted copy of the DEK along with the data.</li>
<li>When a service needs to decrypt data, it requests KMS to decrypt the DEK using your master key.</li>
<li>If authorized, KMS returns the decrypted DEK, which the service uses to decrypt your data.</li>
<li>All requests to use your master keys are logged in AWS CloudTrail for auditing.</li>
<li>Control who manages/accesses keys via IAM users/roles.</li>
<li>Differs from Secrets Manager as KMS is purpose-built for encryption key management.</li>
<li>Validated by compliance schemes (e.g., PCI DSS Level 1, FIPS 140-2 Level 2).</li>
</ul>
<hr>

<h3 id="key-management">Key Management with KMS Functions</h3>
<ul>
<li>Create keys with alias/description.</li>
<li>Import your own key material.</li>
<li>Define IAM users/roles for key management and usage (encrypt/decrypt).</li>
<li>Choose automatic annual key rotation (for symmetric customer-managed keys).</li>
<li>Temporarily disable/re-enable keys.</li>
<li>Schedule keys for deletion.</li>
<li>Audit key use via CloudTrail logs.</li>
<li>Create, connect, disconnect, delete custom key stores (requires CloudHSM).</li>
</ul>
<hr>

<h3 id="data-encryption-scenarios">Data Encryption Scenarios</h3>
<ul>
<li><strong>Direct KMS API calls:</strong> Encrypt/decrypt data directly using master keys in KMS (for small data <= 4KB).</li>
<li><strong>AWS Service Integration:</strong> AWS services encrypt your data using DEKs protected by your KMS master keys.</li>
<li><strong>AWS Encryption SDK:</strong> Perform encryption within your own applications (in AWS or not), integrated with KMS.</li>
</ul>
<hr>

<h3 id="custom-key-store">Custom Key Store</h3>
<ul>
<li>Combines AWS CloudHSM controls with KMS ease of use.</li>
<li>Configure your own CloudHSM cluster and authorize KMS to use it as a dedicated key store.</li>
<li>Keys created in a custom key store generate key material in your CloudHSM cluster and never leave the HSMs in plaintext.</li>
<li>All KMS operations using these keys are performed only in your HSMs.</li>
</ul>
<hr>

<h3 id="key-deletion">Key Deletion</h3>
<ul>
<li>Can schedule customer-managed KMS keys for deletion.</li>
<li>Configurable waiting period: 7 to 30 days (default is 30 days).</li>
<li>Waiting period allows verifying impact on applications.</li>
<li>Can cancel key deletion during the waiting period.</li>
</ul>
<hr>

<h3 id="kms-apis">AWS KMS APIs (Developer Focus)</h3>
<ul>
<li><code>Encrypt</code>: Encrypts plaintext (up to 4KB) using a KMS key. Can move encrypted data between regions.</li>
<li><code>Decrypt</code>: Decrypts ciphertext encrypted by various KMS operations.</li>
<li><code>ReEncrypt</code>: Decrypts and then re-encrypts ciphertext entirely within KMS.
<ul>
<li>Used to change the KMS key protecting data (manual rotation).</li>
<li>Used to change encryption context under the same KMS key.</li>
</ul>
</li>
<li><code>EnableKeyRotation</code>: Enables automatic annual rotation for symmetric customer-managed KMS keys.</li>
<li><code>GenerateDataKey</code>: Generates a unique symmetric data key (plaintext and encrypted copy).</li>
<li><code>GenerateDataKeyWithoutPlaintext</code>: Generates a unique symmetric data key (only returns encrypted copy).</li>
<li><code>GenerateDataKeyPair</code> / <code>GenerateDataKeyPairWithoutPlaintext</code>: For asymmetric data key pairs.</li>
</ul>
<hr>

<h3 id="envelope-encryption">KMS Envelope Encryption</h3>
<ul>
<li>Method used by KMS-integrated AWS services and client-side toolkits.</li>
<li>KMS generates a data key (DEK) to encrypt the actual data.</li>
<li>The DEK itself is then encrypted using your KMS key (CMK).</li>
<li>This "envelope" (encrypted DEK + encrypted data) is stored.</li>
<li>To decrypt data, the encrypted DEK is first sent to KMS to be decrypted by the CMK, then the plaintext DEK is used to decrypt the data.</li>
</ul>
<hr>

<h3 id="kms-limits">KMS Limits</h3>
<ul>
<li>Up to 1000 KMS keys per account per region (enabled and disabled count). AWS recommends deleting unused disabled keys.</li>
<li>AWS managed master keys (created by services) do not count against this limit.</li>
<li>No limit on the number of data keys derived using a master key.</li>
</ul>
<hr>

<h3 id="kms-exam-tips">Important Exam Tips</h3>
<ul>
<li><strong>Regional Service:</strong> KMS keys are regional. (<strong>Exam Tip!</strong>)</li>
<li><strong>Symmetric vs. Asymmetric:</strong> Understand the difference and typical use cases (symmetric for data encryption, asymmetric for digital signatures/key exchange).</li>
<li><strong>KMS Key vs. Data Key:</strong> Critical distinction. KMS keys protect data keys; data keys encrypt the actual data. KMS does not store data keys.</li>
<li><strong>Rotation:</strong> Only customer-managed symmetric KMS keys can have automatic annual rotation. Custom Lambda functions for other types.</li>
<li><strong>KMS vs. CloudHSM:</strong> KMS uses HSMs, but you don't manage them directly. CloudHSM gives you dedicated, single-tenant HSMs that you manage, allowing key export. Custom Key Store bridges this.</li>
<li><strong>KMS vs. Secrets Manager:</strong> KMS manages encryption keys. Secrets Manager manages secrets (credentials, API keys) and offers rotation for them. Secrets Manager uses KMS for encryption.</li>
<li><strong>Encryption Context:</strong> Important for auditing and policy enforcement. Additional authenticated data (AAD) that provides context to the encryption operation.</li>
<li><strong>Key Policy vs. IAM Policy:</strong> Both control access. Key policies define who can use the key; IAM policies define what actions a principal can take on KMS resources. They work together.</li>
<li><strong>CloudTrail:</strong> All KMS API calls are logged in CloudTrail for auditing.</li>
<li><strong>Data Size Limit:</strong> KMS can directly encrypt only up to 4KB. For larger data, use envelope encryption with DEKs.</li>
</ul>
<hr>